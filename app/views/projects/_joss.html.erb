<% if @project.joss_metadata.present? %>
  <h3>JOSS Publication</h3>
  <div class="card mb-3">
    <div class="card-body">
      <h5 class="card-title"><%= @project.joss_metadata['title'] %></h5>
      
      <p class="card-text">
        <strong>Published:</strong> <%= Date.parse(@project.joss_metadata['published_at']).strftime("%B %d, %Y") if @project.joss_metadata['published_at'] %><br>
        <strong>DOI:</strong> <%= link_to @project.joss_metadata['doi'], "https://doi.org/#{@project.joss_metadata['doi']}", target: "_blank" if @project.joss_metadata['doi'] %><br>
        <strong>Volume:</strong> <%= @project.joss_metadata['volume'] %>, 
        <strong>Issue:</strong> <%= @project.joss_metadata['issue'] %>, 
        <strong>Page:</strong> <%= @project.joss_metadata['page'] %>
      </p>

      <% if @project.joss_metadata['authors'].present? %>
        <p>
          <strong>Authors:</strong><br>
          <% @project.joss_metadata['authors'].each do |author| %>
            <%= author['given_name'] %> <%= author['middle_name'] %> <%= author['last_name'] %>
            <% if author['orcid'].present? %>
              <%= link_to image_tag("https://orcid.org/sites/default/files/images/orcid_16x16.png", alt: "ORCID", style: "width: 16px; height: 16px;"), 
                          "https://orcid.org/#{author['orcid']}", target: "_blank", title: "ORCID: #{author['orcid']}" %>
            <% end %>
            <br>
            <small class="text-muted"><%= author['affiliation'] %></small><br>
          <% end %>
        </p>
      <% end %>

      <% if @project.joss_metadata['editor_name'].present? %>
        <p>
          <strong>Editor:</strong> 
          <%= @project.joss_metadata['editor_name'] %>
          <% if @project.joss_metadata['editor_orcid'].present? %>
            <%= link_to image_tag("https://orcid.org/sites/default/files/images/orcid_16x16.png", alt: "ORCID", style: "width: 16px; height: 16px;"), 
                        "https://orcid.org/#{@project.joss_metadata['editor_orcid']}", target: "_blank", title: "ORCID: #{@project.joss_metadata['editor_orcid']}" %>
          <% end %>
        </p>
      <% end %>

      <% if @project.joss_metadata['tags'].present? %>
        <p>
          <strong>Tags:</strong><br>
          <% @project.joss_metadata['tags'].split(',').each do |tag| %>
            <span class="badge bg-secondary"><%= tag.strip %></span>
          <% end %>
        </p>
      <% end %>

      <div class="btn-group" role="group">
        <% if @project.joss_metadata['pdf_url'].present? %>
          <%= link_to "View PDF", @project.joss_metadata['pdf_url'], target: "_blank", class: "btn btn-sm btn-outline-primary" %>
        <% end %>
        <% if @project.joss_metadata['paper_review'].present? %>
          <%= link_to "Review Thread", @project.joss_metadata['paper_review'], target: "_blank", class: "btn btn-sm btn-outline-secondary" %>
        <% end %>
        <% if @project.joss_metadata['software_archive'].present? %>
          <%= link_to "Software Archive", @project.joss_metadata['software_archive'], target: "_blank", class: "btn btn-sm btn-outline-secondary" %>
        <% end %>
      </div>
    </div>
  </div>
<% end %>